{% extends 'home/includes/base.html' %}
{% load static%}
{% block main_block %}
    <div class="card">
        <div class="card-body text-center d-flex flex-column align-items-center">
            <div class="bs-icon-xl bs-icon-circle bs-icon-primary shadow bs-icon my-4"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-person">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"></path>
                </svg></div>
                <form method="post" data-bs-theme="light" id="form">
                    {% csrf_token %}
                    <div class="mb-3">
                        <input class="form-control" required type="text" name="username" id="username" placeholder="username">
                        <div class="invalid-feedback" id="username_error"></div>
                    </div>
                    <div class="mb-3">
                        <input class="form-control" required type="email" name="email" id="email" placeholder="Email">
                        <div class="invalid-feedback" id="email_error"></div>
                    </div>
                    <div class="mb-3">
                        <input class="form-control" required type="password" name="password" id="password1" placeholder="Password">
                        <div class="invalid-feedback" id="password_error"></div>
                    </div>
                    <div class="mb-3">
                        <input class="form-control" required type="password" name="password2" id="password2" placeholder="Confirm Password">
                        <div class="invalid-feedback" id="password2_error"></div>
                    </div>
                    <span class="text-danger" id="validation_error">{{form_errors}}</span>
                    <div class="mb-3">
                        <button class="btn btn-primary shadow d-block w-100" type="submit">Sign up</button>
                    </div>
                </form>
            <p class="text-muted">Already have an account?&nbsp;<a href="{% url 'login' %}">Log in</a></p>
        </div>
    </div>

    <!-- script for form validation -->
    <script>
        // check if email field is valid
        function validateEmail(email) {
            var re = /\S+@\S+\.\S+/;
            return re.test(email);
        }

        // check if password field is valid
        function validatePassword(password) {
            // Check if the password length is exactly 8 characters
            var re = /^[a-zA-Z0-9_]{8,}$/;
            return re.test(password);
        }

        // check if username field is valid
        function validateUsername(username) {
            var re = /^[a-zA-Z0-9_]{4,}[a-zA-Z]+[0-9]*$/;
            return re.test(username);
        }

        // check if password and confirm password fields match
        function validatePasswordMatch(password1, password2) {
            return password1 === password2;
        }

        // check if all fields are valid
        function validateForm(username, email, password1, password2) {
            return validateUsername(username) && validateEmail(email) && validatePassword(password1) && validatePasswordMatch(password1, password2);
        }

        // Function to display error message for a field
        function displayError(field, message) {
            const errorElement = document.getElementById(`${field}_error`);
            if (errorElement) {
                errorElement.innerHTML = message;
            }
        }

        // validate each input on input 
        username.addEventListener('input', function() {
            if (validateUsername(username.value)) {
                username.classList.remove('is-invalid');
                username.classList.add('is-valid');
                displayError('username', ''); // Clear any previous error
            } else {
                username.classList.remove('is-valid');
                username.classList.add('is-invalid');
                displayError('username', 'Must be at least 4 characters long<br>start with a letter.<br>Don\' include spaces');
            }
        });

        email.addEventListener('input', function() {
            if (validateEmail(email.value)) {
                email.classList.remove('is-invalid');
                email.classList.add('is-valid');
                displayError('email', ''); // Clear any previous error
            } else {
                email.classList.remove('is-valid');
                email.classList.add('is-invalid');
                displayError('email', 'Please enter a valid email address.');
            }
        });

        password1.addEventListener('input', function() {
            if (validatePassword(password1.value)) {
                password1.classList.remove('is-invalid');
                password1.classList.add('is-valid');
                displayError('password', ''); // Clear any previous error
            } else {
                password1.classList.remove('is-valid');
                password1.classList.add('is-invalid');
                displayError('password', 'Password must be at least 8 characters long<br>Contain only letters, digits, and underscores.');
            }
        });

        password2.addEventListener('input', function() {
            if (validatePasswordMatch(password1.value, password2.value)) {
                password2.classList.remove('is-invalid');
                password2.classList.add('is-valid');
                displayError('password2', ''); // Clear any previous error
            } else {
                password2.classList.remove('is-valid');
                password2.classList.add('is-invalid');
                displayError('password2', 'Passwords do not match.');
            }
        });

        // validate form on submit
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (validateForm(username.value, email.value, password1.value, password2.value)) {
                form.submit();
            } else {
                document.getElementById('validation_error').innerHTML = 'Please fill all fields correctly';
                
            }
        });


    </script>
{% endblock %}